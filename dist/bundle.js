!function(t){var e={};function o(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){"use strict";o.r(e);class n{constructor(t="keyval-store",e="keyval"){this.storeName=e,this._dbp=new Promise((o,n)=>{const i=indexedDB.open(t,1);i.onerror=()=>n(i.error),i.onsuccess=()=>o(i.result),i.onupgradeneeded=()=>{i.result.createObjectStore(e)}})}_withIDBStore(t,e){return this._dbp.then(o=>new Promise((n,i)=>{const s=o.transaction(this.storeName,t);s.oncomplete=()=>n(),s.onabort=s.onerror=()=>i(s.error),e(s.objectStore(this.storeName))}))}}let i;function s(){return i||(i=new n),i}function r(t,e=s()){let o;return e._withIDBStore("readonly",e=>{o=e.get(t)}).then(()=>o.result)}class c{constructor(t){this.outletId,this.emitter=t,this.elem=document.querySelector(".js-btn-removed"),this.onClick=this.onClick.bind(this),this.elem.addEventListener("click",this.onClick)}onClick(){const t={outletId:this.outletId,status:"removed"};this.emitter.emit("data-update",t)}}class a{constructor(t){this.outletId,this.emitter=t,this.elem=document.querySelector(".js-btn-present"),this.onClick=this.onClick.bind(this),this.elem.addEventListener("click",this.onClick)}onClick(){const t={outletId:this.outletId,status:"present"};this.emitter.emit("data-update",t)}}class l{constructor(){this.elem=document.querySelector(".js-btn-save"),this.data=[],this.update=this.update.bind(this),this.onClick=this.onClick.bind(this),this.elem.addEventListener("click",this.onClick)}async onClick(){let t=await r("collection-boxes");t||(t=[]),t.push(...this.data),this.data=[],await function(t,e,o=s()){return o._withIDBStore("readwrite",o=>{o.put(e,t)})}("collection-boxes",t)}async update(t){let e=await r("collection-boxes");e||(e=[]);const o=e.findIndex(e=>e.outletId==t.outletId);-1==o?this.data.push(t):this.data[o]=t}}var d,u=class{constructor(t){this.data,this.emitter=t,this.containerElem=document.querySelector(".js-data-entry-container"),this.removedBtn=new c(t),this.presentBtn=new a(t),this.saveBtn=new l,this.collectionBoxInfo=document.querySelector(".js-collection-box-info"),this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.update=this.update.bind(this)}update(t){this.data={outletId:t.outletId},this.removedBtn.outletId=t.OUTLETID,this.presentBtn.outletId=t.OUTLETID,this.collectionBoxInfo.innerHTML=`<p>Address:${t.ADDR1}</p><p>Outlet ID:${t.OUTLETID}</p>`}show(t){this.containerElem.classList.remove("data-entry-container--hidden"),this.update(t)}hide(){this.containerElem.classList.remove("data-entry-container--hidden")}};class h{constructor(t){this.emitter=t,this.elem=document.querySelector(".js-btn-back"),this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.onClick=this.onClick.bind(this),this.elem.addEventListener("click",this.onClick)}onClick(){this.emitter.emit("show-map"),this.hide()}show(){this.elem.classList.remove("btn-back--hidden")}hide(){this.elem.classList.add("btn-back--hidden")}}{const t={all:d=d||new Map,on:function(t,e){var o=d.get(t);o&&o.push(e)||d.set(t,[e])},off:function(t,e){var o=d.get(t);o&&o.splice(o.indexOf(e)>>>0,1)},emit:function(t,e){(d.get(t)||[]).slice().map((function(t){t(e)})),(d.get("*")||[]).slice().map((function(o){o(t,e)}))}},e=new u(t),o=new h(t);t.on("point-select",e.show),t.on("point-select",(function(){document.querySelector(".overview-container").classList.add("overview-container--hidden")})),t.on("point-select",o.show),t.on("data-update",e.saveBtn.update),t.on("save-data",(async function(t){let e=await get("collection-boxes");e||(e=[]),e.push(t),await set("collection-boxes",e)})),t.on("show-map",(function(){document.querySelector(".overview-container").classList.remove("overview-container--hidden")})),t.on("show-map",e.hide),mapboxgl.accessToken="pk.eyJ1IjoicnVzc2JpZ2dzIiwiYSI6ImNrZHg2am55ejE3aHYyeWtqOGtocjh4ejgifQ.Qg_LH8LUNchJZBPsqDme9g";var p=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[-106.65,35.08],zoom:9});p.addControl(new MapboxGeocoder({accessToken:mapboxgl.accessToken,mapboxgl:mapboxgl})),p.addControl(new mapboxgl.NavigationControl),p.addControl(new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0})),p.on("load",(function(){p.addSource("collection-box-src",{type:"vector",url:"mapbox://mikelmaron.3ws9y5k1"}),p.addLayer({id:"collection-boxes",type:"circle",source:"collection-box-src","source-layer":"collection_box_trim_valid-0tbyft",paint:{"circle-color":"#004B87","circle-radius":6}}),p.on("mouseenter","collection-boxes",(function(){p.getCanvas().style.cursor="pointer"})),p.on("mouseleave","collection-boxes",(function(){p.getCanvas().style.cursor=""})),p.on("click","collection-boxes",(function(e){t.emit("point-select",e.features[0].properties)}))}));"mediaDevices"in navigator&&console.log("media supported")}}]);